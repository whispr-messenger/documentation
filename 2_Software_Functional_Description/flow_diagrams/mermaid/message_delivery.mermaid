sequenceDiagram
    participant Sender as Expéditeur
    participant SenderApp as Application (Expéditeur)
    participant API as API Gateway
    participant DS as delivery-service
    participant ReceiverApp as Application (Destinataire)
    
    SenderApp->>API: POST /api/v1/messages
    API->>DS: Transmission du message chiffré
    
    DS->>DS: Stockage du message chiffré
    DS->>DS: Enregistrement du statut "envoyé"
    DS-->>API: Confirmation de réception
    API-->>SenderApp: Statut "envoyé"
    SenderApp-->>Sender: Affichage du statut d'envoi
    
    alt Destinataire en ligne
        DS-->>ReceiverApp: Push du message chiffré
        ReceiverApp->>ReceiverApp: Notification de nouveau message
    else Destinataire hors ligne
        DS->>DS: Stockage en file d'attente
        Note over DS,ReceiverApp: Le message sera livré<br/>à la prochaine connexion
    end